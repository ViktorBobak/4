{% extends "base.html" %}
{% block title %}–û—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç | LabHealth{% endblock %}

{% block content %}
<section style="padding:100px 20px; background:#121212; min-height:100vh;">
	<div style="max-width:1200px; margin:0 auto;">

		<!-- –ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è -->
		<div style="text-align:center; margin-bottom:80px;">
			<div
				style="width:160px; height:160px; background:linear-gradient(135deg,#00d8ff,#00ffaa); border-radius:50%; margin:0 auto 25px; display:flex; align-items:center; justify-content:center; font-size:6rem; color:white; box-shadow:0 20px 50px rgba(0,216,255,0.5); font-weight:bold;">
				{{ user.name.split()[0][0] }}{{ user.name.split()[-1][0] if ' ' in user.name else '' }}
			</div>
			<h1 style="color:#00eaff; font-size:3.5em; margin:0;">–í—ñ—Ç–∞—î–º–æ, {{ user.name }}!</h1>
			<p style="color:#00ffaa; font-size:1.6em; margin:15px 0 0;">{{ session.user_email }}</p>
		</div>

		<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑ –µ–º–æ–¥–∑—ñ -->
		<div
			style="display:grid; grid-template-columns:repeat(auto-fit, minmax(240px, 1fr)); text-align: center; gap:30px; margin-bottom:80px;">
			<div
				style="background:#1a1a1a; padding:40px; border-radius:28px; text-align:center; border:3px solid #00ffaa;">
				<div style="font-size:4rem; margin-bottom:15px;">–í—Å—å–æ–≥–æ –∑–∞–ø–∏—Å—ñ–≤</div>
				<p style="color:#00ffaa; font-size:4em; font-weight:700; margin:10px 0;">{{ user.appointments|length
					}}</p>
				<p style="color:#888; font-size:1.1em;"></p>
			</div>

			<div
				style="background:#1a1a1a; padding:40px; border-radius:28px; text-align:center; border:3px solid #00d8ff;">
				<div style="font-size : 4rem; margin-bottom:15px;">–ì–æ—Ç–æ–≤—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏</div>
				<p style="color:#00d8ff; font-size:4em; font-weight:700; margin:10px 0;">
					{{ user.appointments|selectattr("status","equalto","–ì–æ—Ç–æ–≤–æ")|list|length }}
				</p>
				<p style="color:#888; font-size:1.1em;"></p>
			</div>
		</div>

		<!-- –ó–∞–ø–∏—Å–∏ -->
		<div style="margin-bottom:60px;">
			<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:40px;">
				<h2 style="color:#00eaff; font-size:2.8em; margin:0;">–ú–æ—ó –∞–Ω–∞–ª—ñ–∑–∏ —Ç–∞ –∑–∞–ø–∏—Å–∏</h2>
				<a href="/appointment"
					style="padding:16px 40px; background:#00ffaa; color:#121212; border-radius:60px; font-size:1.4em; text-decoration:none; font-weight:700;">
					+ –ù–æ–≤–∏–π –∑–∞–ø–∏—Å
				</a>
			</div>
			<h2 style="color:#00eaff; margin-top:40px;">üì© –í–∞—à—ñ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—è</h2>

			{% for m in messages %}
			<div style="background:#1a1a1a; padding:20px; border-radius:12px; margin-bottom:20px;">
				<p><strong>–í–∞—à–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong> {{ m.message }}</p>

				{% if m.reply %}
				<p style="color:#00ffaa;"><strong>–í—ñ–¥–ø–æ–≤—ñ–¥—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó:</strong> {{ m.reply }}</p>
				{% else %}
				<p style="color:gray;">–û—á—ñ–∫—É—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ...</p>
				{% endif %}
			</div>
			{% endfor %}

			{% if user.appointments %}
			{% for apt in user.appointments|reverse %}
			<div
				style="background:#1a1a1a; padding:35px; border-radius:32px; margin-bottom:30px; border-left:8px solid {% if apt.status == '–ì–æ—Ç–æ–≤–æ' %}#00ffaa{% else %}#0066ff{% endif %}; box-shadow:0 20px 50px rgba(0,0,0,0.5);">
				<div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:20px;">
					<div>
						<h3 style="color:#00eaff; font-size:2em; margin:0 0 12px;">{{ apt.service }}</h3>
						<p style="color:#00d8ff; font-size:1.4em; margin:5px 0;">
							Doctor {{ apt.doctor }} ‚Ä¢ {{ apt.date }} –æ {{ apt.time }}
						</p>
						{% if apt.result_date %}
						<p style="color:#aaa; margin:10px 0 0;">–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ñ–¥ {{ apt.result_date }}</p>
						{% endif %}
					</div>

					<div style="text-align:right;">
						{% if apt.status == '–ì–æ—Ç–æ–≤–æ' %}
						<div
							style="background:#00ffaa; color:#121212; padding:14px 35px; border-radius:50px; font-weight:700; margin-bottom:15px; text-align: center;">
							–†–µ–∑—É–ª—å—Ç–∞—Ç –≥–æ—Ç–æ–≤–∏–π
						</div>
						<a href="/view_result/{{ loop.revindex0 }}"
							style="display:inline-block; padding:14px 40px; background:#00d8ff; color:white; border-radius:50px; text-decoration:none; font-weight:700; font-size:1.2em;">
							–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
						</a>
						{% else %}
						<div
							style="background:#0066ff; color:white; padding:14px 35px; border-radius:50px; font-weight:700;">
							{{ apt.status }}
						</div>
						{% endif %}

						{% if apt.status == "–û—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è" %}
						<a href="/cancel_appointment/{{ loop.revindex0 }}" onclick="return confirm('–°–∫–∞—Å—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å?')"
							style="display:block; margin-top:20px; color:#ff6666; font-size:1.1em; text-decoration:underline;">
							–°–∫–∞—Å—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Å
						</a>
						{% endif %}
					</div>
				</div>
			</div>
			{% endfor %}
			{% else %}
			<div style="text-align:center; padding:120px; background:#1a1a1a; border-radius:32px;">
				<div style="font-size:10rem; opacity:0.2; margin-bottom:30px;">Clipboard</div>
				<p style="color:#777; font-size:1.8em;">–ó–∞–ø–∏—Å—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î</p>
				<a href="/appointment"
					style="margin-top:30px; padding:20px 60px; background:#00ffaa; color:#121212; border-radius:60px; font-size:1.5em; text-decoration:none;">
					–ó–∞–ø–∏—Å–∞—Ç–∏—Å—è ‚Üí
				</a>
			</div>
			{% endif %}
		</div>

		<!-- –í–∏—Ö—ñ–¥ -->
		<div style="text-align:center;">
			<a href="/logout"
				style="padding:18px 70px; background:#ff4444; color:white; border-radius:60px; font-size:1.5em; text-decoration:none; font-weight:700;">
				–í–∏–π—Ç–∏ –∑ –∫–∞–±—ñ–Ω–µ—Ç—É
			</a>
		</div>
	</div>
</section>
{% endblock %}